<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>WeedTracker V60 Pilot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Icons / Meta -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="theme-color" content="#111418" />

  <!-- Styles & App Scripts (exact filenames) -->
  <link rel="stylesheet" href="styles.css" />
  <script defer src="storage.js"></script>
  <script defer src="extras.js"></script>
  <script defer src="settings.js"></script>
  <script defer src="apps.js"></script>
</head>
<body>

  <!-- Splash -->
  <div id="splash" class="splash">
    <div class="logo">üåø</div>
    <div class="brand">WeedTracker V60 Pilot</div>
  </div>

  <!-- Global Spinner -->
  <div id="spinner" class="spinner-overlay">
    <div class="spinner"></div>
    <div class="spinner-msg" id="spinnerMsg">Working‚Ä¶</div>
  </div>

  <!-- Top Bar -->
  <header class="appbar">
    <div class="appbar-left">
      <span class="app-title">üåø WeedTracker V60 Pilot</span>
    </div>
    <div class="appbar-right">
      <button class="pill home-btn" id="homeBtn" title="Home">Home</button>
    </div>
  </header>

  <!-- MAIN SCREENS -->
  <main class="screens">

    <!-- HOME -->
    <section id="home" class="screen active">
      <div class="home-grid">
        <!-- one per row ‚Äì 7 rows -->
        <button class="home-card" data-target="createTask">üìù Create Task</button>
        <button class="home-card" data-target="records">üìÅ Records</button>
        <button class="home-card" data-target="inventory">üß™ Chemical Inventory</button>
        <button class="home-card" data-target="batches">üßØ Batches</button>
        <button class="home-card" data-target="procurement">üõí Procurement List</button>
        <button class="home-card" data-target="mapping">üó∫Ô∏è Mapping</button>
        <button class="home-card" data-target="settings">‚öôÔ∏è Settings</button>
      </div>
    </section>

    <!-- CREATE TASK -->
    <section id="createTask" class="screen">
      <h2>Create Task</h2>

      <div class="card p">

        <!-- Location before AutoName (as requested) -->
        <label class="lbl">Location (tap to fetch road / reverse geocode)</label>
        <div class="row gap">
          <button id="locateBtn" class="pill">Get Location</button>
          <div id="locRoad" class="muted mono">Unknown</div>
        </div>

        <label class="lbl">Auto Name</label>
        <div class="row gap">
          <button id="autoNameBtn" class="pill">Auto-name</button>
          <input id="jobName" class="in" type="text" placeholder="Job name" />
        </div>

        <label class="lbl">Council Job Number</label>
        <input id="councilNum" class="in" type="text" placeholder="e.g. 23/01234" />

        <label class="lbl">Link Inspection / Existing Job (optional)</label>
        <input id="linkInspectionId" class="in" type="text" placeholder="Paste inspection/job ID to link" />

        <div class="grid two">
          <div>
            <label class="lbl">Task Type</label>
            <select id="taskType" class="in">
              <option>Inspection</option>
              <option>Spot Spray</option>
              <option>Road Spray</option>
            </select>
          </div>
          <div>
            <label class="lbl">Date</label>
            <input id="jobDate" class="in" type="date" />
          </div>
        </div>

        <div class="grid two">
          <div>
            <label class="lbl">Start Time</label>
            <input id="startTime" class="in" type="time" />
          </div>
          <div>
            <label class="lbl">Finish Time</label>
            <input id="endTime" class="in" type="time" />
          </div>
        </div>

        <label class="lbl">Weed</label>
        <select id="weedSelect" class="in">
          <!-- populated by apps.js; noxious pinned to top with ‚ö† -->
        </select>

        <label class="lbl">Batch</label>
        <select id="batchSelect" class="in">
          <!-- populated by apps.js -->
        </select>

        <div class="card soft p mt">
          <div class="row spread">
            <div class="lbl">Weather</div>
            <button id="autoWeatherBtn" class="pill">Auto Weather</button>
          </div>
          <div class="grid four">
            <div>
              <label class="lbl">Temp (¬∞C)</label>
              <input id="temp" class="in" inputmode="decimal" />
            </div>
            <div>
              <label class="lbl">Wind (km/h)</label>
              <input id="wind" class="in" inputmode="decimal" />
            </div>
            <div>
              <label class="lbl">Wind Dir (deg / NESW)</label>
              <input id="windDir" class="in" placeholder="e.g. 90¬∞ E" />
            </div>
            <div>
              <label class="lbl">Humidity (%)</label>
              <input id="humidity" class="in" inputmode="decimal" />
            </div>
          </div>
          <div class="muted tiny mt-2">Last updated: <span id="wxUpdated">‚Äî</span></div>
        </div>

        <div class="grid three mt">
          <div>
            <label class="lbl">Reminder (weeks)</label>
            <select id="reminderWeeks" class="in"></select>
          </div>
          <div>
            <label class="lbl">Status</label>
            <div class="row gap wrap">
              <label class="chip"><input type="radio" name="status" value="Complete">Complete</label>
              <label class="chip"><input type="radio" name="status" value="Incomplete" checked>Incomplete</label>
              <label class="chip"><input type="radio" name="status" value="Draft">Draft</label>
            </div>
          </div>
          <div>
            <label class="lbl">Attach Photo</label>
            <input id="photoInput" class="in" type="file" accept="image/*" capture="environment" />
          </div>
        </div>

        <img id="photoPreview" alt="" class="photo-preview" style="display:none" />

        <!-- Roadside tracking ‚Äì visible only for TaskType=Road Spray -->
        <div id="roadTrackBlock" class="card soft p mt" style="display:none">
          <div class="row spread">
            <div class="lbl">Roadside Tracking</div>
            <div id="trackStatus" class="muted">Idle</div>
          </div>
          <div class="row gap">
            <button id="startTrack" class="pill">Start Tracking</button>
            <button id="stopTrack" class="pill warn">Stop Tracking</button>
          </div>
        </div>

        <label class="lbl mt">Notes</label>
        <textarea id="notes" class="in" rows="4" placeholder="Notes‚Ä¶"></textarea>

        <div class="row gap end mt">
          <button id="saveDraft" class="pill">Save Draft</button>
          <button id="saveTask" class="pill emph">Save Task</button>
        </div>
      </div>
    </section>

    <!-- RECORDS -->
    <section id="records" class="screen">
      <h2>Records</h2>

      <details class="filters" open>
        <summary>Filters</summary>
        <div class="grid three">
          <div>
            <label class="lbl">Search (name / weed / council / road)</label>
            <input id="recSearch" class="in" placeholder="e.g. Wombat Road" />
          </div>
          <div>
            <label class="lbl">From</label>
            <input id="recFrom" class="in" type="date" />
          </div>
          <div>
            <label class="lbl">To</label>
            <input id="recTo" class="in" type="date" />
          </div>
        </div>

        <div class="row gap wrap mt">
          <div class="group">
            <div class="muted tiny">Type</div>
            <label class="chip"><input id="fInspection" type="checkbox" />Inspection</label>
            <label class="chip"><input id="fSpot" type="checkbox" />Spot Spray</label>
            <label class="chip"><input id="fRoad" type="checkbox" />Road Spray</label>
          </div>
          <div class="group">
            <div class="muted tiny">Status</div>
            <label class="chip"><input id="fComplete" type="checkbox" />Complete</label>
            <label class="chip"><input id="fIncomplete" type="checkbox" />Incomplete</label>
            <label class="chip"><input id="fDraft" type="checkbox" />Draft</label>
          </div>
          <div class="row gap end flex-1">
            <button id="recResetBtn" class="pill">Reset</button>
            <button id="recSearchBtn" class="pill emph">Search</button>
          </div>
        </div>
      </details>

      <div id="recordsList" class="list mt"></div>
    </section>

    <!-- BATCHES -->
    <section id="batches" class="screen">
      <h2>Batches</h2>

      <details class="filters" open>
        <summary>Filters</summary>
        <div class="grid three">
          <div>
            <label class="lbl">From</label>
            <input id="batFrom" class="in" type="date" />
          </div>
          <div>
            <label class="lbl">To</label>
            <input id="batTo" class="in" type="date" />
          </div>
          <div class="row gap end">
            <button id="batResetBtn" class="pill">Reset</button>
            <button id="batSearchBtn" class="pill emph">Search</button>
          </div>
        </div>
      </details>

      <div class="row gap end mt">
        <button id="newBatch" class="pill">New Batch</button>
      </div>
      <div id="batchList" class="list mt"></div>
    </section>

    <!-- INVENTORY -->
    <section id="inventory" class="screen">
      <h2>Chemical Inventory</h2>

      <div class="row gap">
        <button id="addChem" class="pill">Add Chemical</button>
        <a id="openSDS" class="pill" href="https://www.pilot.net.au/sds" target="_blank" rel="noopener">SDS Portal</a>
      </div>

      <ul id="procList" class="muted mt"></ul>
      <div id="chemList" class="list mt"></div>

      <!-- Full-screen editor (sheet style) -->
      <div id="chemEditSheet" class="sheet">
        <div class="sheet-inner">
          <h3>Edit Chemical</h3>
          <div class="grid two">
            <div>
              <label class="lbl">Name</label>
              <input id="ce_name" class="in" />
            </div>
            <div>
              <label class="lbl">Active Ingredient</label>
              <input id="ce_active" class="in" />
            </div>
          </div>
          <div class="grid three">
            <div>
              <label class="lbl">Container Size</label>
              <input id="ce_size" class="in" inputmode="decimal" />
            </div>
            <div>
              <label class="lbl">Unit</label>
              <select id="ce_unit" class="in">
                <option>L</option>
                <option>mL</option>
                <option>g</option>
                <option>kg</option>
              </select>
            </div>
            <div>
              <label class="lbl">Containers</label>
              <input id="ce_count" class="in" inputmode="numeric" />
            </div>
          </div>
          <div>
            <label class="lbl">Reorder Threshold (containers)</label>
            <input id="ce_threshold" class="in" inputmode="numeric" />
          </div>
          <div class="row gap end mt">
            <button id="ce_cancel" class="pill">Close</button>
            <button id="ce_save" class="pill emph">Save</button>
          </div>
        </div>
      </div>
    </section>

    <!-- PROCUREMENT -->
    <section id="procurement" class="screen">
      <h2>Procurement</h2>
      <p class="muted">Low stock items auto-appear here based on thresholds.</p>
      <ul id="procListView" class="list"></ul>
    </section>

    <!-- MAPPING -->
    <section id="mapping" class="screen">
      <h2>Mapping</h2>

      <details class="filters" open>
        <summary>Filters</summary>
        <div class="grid four">
          <div>
            <label class="lbl">Weed</label>
            <input id="mapWeed" class="in" placeholder="Type weed name‚Ä¶" />
          </div>
          <div>
            <label class="lbl">Type</label>
            <select id="mapType" class="in">
              <option>All</option>
              <option>Inspection</option>
              <option>Spot Spray</option>
              <option>Road Spray</option>
            </select>
          </div>
          <div>
            <label class="lbl">From</label>
            <input id="mapFrom" class="in" type="date" />
          </div>
          <div>
            <label class="lbl">To</label>
            <input id="mapTo" class="in" type="date" />
          </div>
        </div>
        <div class="row gap end mt">
          <button id="mapResetBtn" class="pill">Reset</button>
          <button id="mapSearchBtn" class="pill emph">Search</button>
        </div>
      </details>

      <div id="mapWrap" class="map-wrap">
        <div id="map" class="map"></div>
      </div>
      <div class="muted tiny mt">Tap a pin to Open or Navigate (Apple Maps).</div>
    </section>

    <!-- SETTINGS -->
    <section id="settings" class="screen">
      <h2>Settings</h2>

      <div class="card p">
        <label class="lbl">Account Email (for future sync)</label>
        <div class="row gap">
          <input id="accountEmail" class="in" type="email" placeholder="you@email.com" />
          <button id="saveAccount" class="pill">Save</button>
        </div>

        <div class="row gap wrap mt">
          <button id="exportBtn" class="pill">Export Data</button>
          <button id="restoreBtn" class="pill">Restore Latest Backup</button>
          <button id="clearBtn" class="pill warn">Clear All Local Data</button>
        </div>
      </div>
    </section>

  </main>

  <!-- Leaflet (CDN) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
    defer
  ></script>

  <!-- Modals live here (created by JS) -->
  <div id="modal-root"></div>

</body>
</html>
