<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>WeedTracker V60 Pilot Final</title>
  <link rel="stylesheet" href="styles.css"/>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" defer></script>

  <!-- App scripts (order matters) -->
  <script src="storage.js" defer></script>
  <script src="extras.js" defer></script>
  <script src="batches.js" defer></script>
  <script src="settings.js" defer></script>
  <script src="apps.js" defer></script>
</head>

<body class="theme-dark">
  <!-- Spinner -->
  <div id="spinner" class="spinner-overlay hidden">
    <div class="spinner"></div>
    <div id="spinnerText" class="spinner-text">Working…</div>
  </div>

  <!-- Toasts -->
  <div id="toastHost"></div>

  <!-- Header -->
  <header class="app-header">
    <h1>🌿 WeedTracker V60 Pilot Final</h1>
    <button id="homeBtn" class="icon-btn" title="Home">🏠</button>
  </header>

  <!-- HOME -->
  <main id="home" class="screen active">
    <section class="menu">
      <button class="menu-btn green"  data-target="create">📝 Create Task</button>
      <button class="menu-btn blue"   data-target="records">📄 Records</button>
      <button class="menu-btn aqua"   data-target="chem">💧 Chemical Inventory</button>
      <button class="menu-btn lime"   data-target="batches">🧪 Batches</button>
      <button class="menu-btn gray"   data-target="procure">🛒 Procurement List</button>
      <button class="menu-btn purple" data-target="map">🗺️ Mapping</button>
      <button class="menu-btn slate"  data-target="settings">⚙️ Settings</button>
    </section>
  </main>

  <!-- CREATE TASK -->
  <main id="create" class="screen">
    <form id="taskForm" autocomplete="off">
      <div class="card">
        <h2>Create Task</h2>

        <label>Task Type
          <select id="taskType" required>
            <option value="inspection">Inspection</option>
            <option value="roadspray">Road Spray</option>
            <option value="spotspray">Spot Spray</option>
          </select>
        </label>

        <div class="row">
          <button type="button" id="locateBtn" class="pill">📍 Locate</button>
          <button type="button" id="autoNameBtn" class="pill">Auto Name</button>
        </div>

        <label>Job Name
          <input id="jobName" placeholder="AutoName result…" required/>
        </label>

        <label>Council Job Number
          <input id="councilNo" placeholder="e.g. 25/1234"/>
        </label>

        <label>Date
          <input id="taskDate" type="date" required/>
        </label>

        <div class="row">
          <label class="grow">Start Time
            <input id="startTime" type="time"/>
          </label>
          <label class="grow">Finish Time
            <input id="finishTime" type="time"/>
          </label>
        </div>

        <label>Weed
          <select id="weedSelect">
            <option value="">— Select Weed —</option>
          </select>
        </label>

        <label>Batch
          <select id="batchSelect">
            <option value="">— Select Batch —</option>
          </select>
        </label>

        <section id="trackBlock" class="card hidden">
          <h3>Roadside Tracking</h3>
          <div class="row">
            <button type="button" id="trkStart" class="pill">▶️ Start</button>
            <button type="button" id="trkStop" class="pill warn">⏹️ Stop</button>
            <div id="trkState" class="pill muted">Idle</div>
          </div>
          <div class="muted">Distance: <span id="trkDist">0.00</span> km</div>
        </section>

        <section class="card soft">
          <div class="row between">
            <h3>Weather</h3>
            <button type="button" id="autoWeatherBtn" class="pill">🌦️ Auto Weather</button>
          </div>
          <div class="grid4">
            <label>Temp (°C)<input id="wTemp" inputmode="decimal"></label>
            <label>Wind (km/h)<input id="wWind" inputmode="decimal"></label>
            <label>Wind Dir (deg)<input id="wDir" inputmode="numeric"></label>
            <label>Humidity (%)<input id="wHum" inputmode="decimal"></label>
          </div>
        </section>

        <label>Reminder (weeks)
          <select id="reminderWeeks">
            <option value="">— None —</option>
            <option value="1">1 week</option>
            <option value="2">2 weeks</option>
            <option value="3">3 weeks</option>
            <option value="4">4 weeks</option>
            <option value="8">8 weeks</option>
          </select>
        </label>

        <label>Notes
          <textarea id="notes" rows="3" placeholder="Job notes…"></textarea>
        </label>

        <div class="row end gap">
          <button type="button" id="saveDraftBtn" class="btn secondary">💾 Save Draft</button>
          <button type="submit" id="saveTaskBtn" class="btn primary">✅ Save Task</button>
        </div>
      </div>
    </form>
  </main>

  <!-- RECORDS -->
  <main id="records" class="screen">
    <h2>Records</h2>
    <section class="card soft">
      <details open>
        <summary>Filters & Search</summary>
        <div class="filters">
          <input id="recQuery" class="input" placeholder="Search job / road / weed / council #">
          <div class="chips">
            <label class="chip"><input type="checkbox" value="inspection" class="recType"> Inspection</label>
            <label class="chip"><input type="checkbox" value="roadspray"  class="recType"> Road Spray</label>
            <label class="chip"><input type="checkbox" value="spotspray"  class="recType"> Spot Spray</label>
            <label class="chip"><input type="checkbox" value="complete"   class="recState"> Complete</label>
            <label class="chip"><input type="checkbox" value="incomplete" class="recState"> Incomplete</label>
            <label class="chip"><input type="checkbox" value="draft"      class="recState"> Draft</label>
          </div>
          <div class="row">
            <input id="recFrom" type="date" class="grow">
            <input id="recTo"   type="date" class="grow">
          </div>
          <div class="row gap">
            <button id="recSearch" class="btn primary" type="button">🔎 Search</button>
            <button id="recReset"  class="btn danger"  type="button">♻️ Reset</button>
          </div>
        </div>
      </details>
    </section>
    <div id="recList" class="list"></div>
  </main>

  <!-- CHEMICALS -->
  <main id="chem" class="screen">
    <h2>Chemical Inventory</h2>
    <div class="row gap">
      <a class="btn secondary" href="#" id="sdsLink">🗂️ SDS Portal</a>
      <button id="addChemBtn" class="btn primary">＋ Add Chemical</button>
    </div>
    <div id="chemList" class="list"></div>
  </main>

  <!-- BATCHES -->
  <main id="batches" class="screen">
    <h2>Batches</h2>
    <section class="card soft">
      <details>
        <summary>Filters</summary>
        <div class="row">
          <input id="batchSearch" class="input grow" placeholder="Search batch ID…">
          <input id="batchFrom" type="date" class="grow">
          <input id="batchTo"   type="date" class="grow">
          <button id="batchDoSearch" class="btn primary" type="button">🔎 Search</button>
        </div>
      </details>
    </section>
    <div id="batchList" class="list"></div>
  </main>

  <!-- MAPPING -->
  <main id="map" class="screen">
    <h2>Mapping</h2>
    <section class="card soft">
      <details open>
        <summary>Filters & Search</summary>
        <div class="filters">
          <input id="mapQuery" class="input" placeholder="Search job / road / weed / council #">
          <div class="chips">
            <label class="chip"><input type="checkbox" value="inspection" class="mapType"> Inspection</label>
            <label class="chip"><input type="checkbox" value="roadspray"  class="mapType"> Road Spray</label>
            <label class="chip"><input type="checkbox" value="spotspray"  class="mapType"> Spot Spray</label>
          </div>
          <div class="row">
            <input id="mapFrom" type="date" class="grow">
            <input id="mapTo"   type="date" class="grow">
          </div>
          <div class="row gap">
            <button id="mapSearch" class="btn primary" type="button">🔎 Search</button>
            <button id="mapReset"  class="btn danger"  type="button">♻️ Reset</button>
          </div>
        </div>
      </details>
    </section>
    <div id="mapHost" class="map"></div>
  </main>

  <!-- SETTINGS -->
  <main id="settings" class="screen">
    <h2>Settings</h2>
    <div class="card">
      <button id="testNotifBtn" class="btn">🔔 Test Notifications</button>
      <button id="exportBtn" class="btn">⬇️ Export Data</button>
      <button id="clearBtn"  class="btn danger">🧹 Clear All Data</button>
    </div>
  </main>

  <div id="popupHost"></div>
</body>
</html>
