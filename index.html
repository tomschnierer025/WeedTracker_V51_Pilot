<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>WeedTrackerV60Pilot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <link rel="stylesheet" href="styles.css"/>

  <!-- Leaflet (Map) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body class="theme-charcoal">

  <!-- Top-right Home button (always visible) -->
  <a id="globalHomeBtn" class="top-right-home">Home</a>

  <!-- Splash -->
  <div id="splash" class="splash">
    <div class="logo">WeedTrackerV60Pilot</div>
    <div class="sub">Loading‚Ä¶</div>
  </div>

  <!-- Spinner overlay -->
  <div id="spinner" class="spinner-overlay" style="display:none">Working‚Ä¶</div>

  <!-- Header -->
  <header class="appbar">
    <h1>WeedTrackerV60Pilot</h1>
    <nav class="tabs">
      <button data-target="home" class="tab">Home</button>
      <button data-target="createTask" class="tab">Create Task</button>
      <button data-target="records" class="tab">Records</button>
      <button data-target="inventory" class="tab">Chemical Inventory</button>
      <button data-target="batches" class="tab">Batches</button>
      <button data-target="mapping" class="tab">Mapping</button>
      <button data-target="settings" class="tab">Settings</button>
    </nav>
  </header>

  <!-- Screens -->
  <main>
    <!-- HOME -->
    <section id="home" class="screen active">
      <div class="grid-1">
        <button class="home-card" data-target="createTask">üìù Create Task</button>
        <button class="home-card" data-target="records">üìö Records</button>
        <button class="home-card" data-target="inventory">‚öóÔ∏è Chemical Inventory</button>
        <button class="home-card" data-target="batches">üß™ Batches</button>
        <button class="home-card" data-target="procurement">üì¶ Procurement List</button>
        <button class="home-card" data-target="mapping">üó∫Ô∏è Mapping</button>
        <button class="home-card" data-target="settings">‚öôÔ∏è Settings</button>
      </div>
    </section>

    <!-- CREATE TASK (vertical steps, clearly labeled) -->
    <section id="createTask" class="screen">
      <div class="card p">
        <h2>Create Task</h2>

        <div class="field">
          <label>1) Locate (for Road Name):</label>
          <div class="row gap">
            <button id="locateBtn" class="pill">Get Location</button>
            <div class="hint"><b>Road:</b> <span id="locRoad">Unknown</span></div>
          </div>
        </div>

        <div class="field">
          <label>2) Auto-Name (RoadName DDMMYY + Type letter):</label>
          <div class="row gap">
            <button id="autoNameBtn" class="pill">Auto-Name</button>
            <input id="jobName" type="text" placeholder="Job Name"/>
          </div>
          <div class="field">
            <label>Council Job Number</label>
            <input id="councilNum" type="text" placeholder="Council Job #"/>
          </div>
        </div>

        <div class="field">
          <label>3) Task Type</label>
          <select id="taskType">
            <option>Inspection</option>
            <option>Spot Spray</option>
            <option>Road Spray</option>
          </select>
        </div>

        <div class="row gap">
          <div class="field flex">
            <label>4) Date</label>
            <input id="jobDate" type="date"/>
          </div>
          <div class="field flex">
            <label>Start Time</label>
            <input id="startTime" type="time"/>
          </div>
          <div class="field flex">
            <label>Finish Time</label>
            <input id="endTime" type="time"/>
          </div>
        </div>

        <div class="field">
          <label>5) Weather</label>
          <div class="row gap wrap">
            <button id="autoWeatherBtn" class="pill">Get Weather</button>
            <div class="field mini">
              <label>Temp ¬∞C</label>
              <input id="temp" inputmode="decimal" />
            </div>
            <div class="field mini">
              <label>Humidity %</label>
              <input id="humidity" inputmode="decimal"/>
            </div>
            <div class="field mini">
              <label>Wind km/h</label>
              <input id="wind" inputmode="decimal"/>
            </div>
            <div class="field mini">
              <label>Wind Direction</label>
              <input id="windDir" placeholder="NE 45¬∞"/>
            </div>
          </div>
          <div class="hint" id="wxUpdated"></div>
        </div>

        <div class="row gap">
          <div class="field flex">
            <label>6) Weed</label>
            <select id="weedSelect"></select>
          </div>
          <div class="field flex">
            <label>Batch</label>
            <select id="batchSelect"></select>
          </div>
        </div>

        <div class="field" id="roadTrackBlock" style="display:none">
          <label>7) Roadside Tracking</label>
          <div class="row gap">
            <button id="startTrack" class="pill">Start Tracking</button>
            <button id="stopTrack" class="pill warn">Stop Tracking</button>
            <div class="hint" id="trackStatus">Not tracking</div>
          </div>
        </div>

        <div class="field">
          <label>8) Add Photo</label>
          <input id="photoInput" type="file" accept="image/*" capture="environment"/>
          <img id="photoPreview" style="display:none;max-width:100%;border-radius:8px;margin-top:.4rem"/>
        </div>

        <div class="row gap">
          <div class="field flex">
            <label>Reminder (weeks)</label>
            <select id="reminderWeeks"></select>
          </div>
          <div class="field flex">
            <label>Status</label>
            <div class="row gap">
              <label class="chip"><input type="radio" name="status" value="Complete"> Complete</label>
              <label class="chip"><input type="radio" name="status" value="Incomplete" checked> Incomplete</label>
            </div>
          </div>
        </div>

        <div class="field">
          <label>Link Existing Job / Inspection (optional)</label>
          <input id="linkInspectionId" type="text" placeholder="Paste Job/Inspection ID to link"/>
        </div>

        <div class="field">
          <label>Notes</label>
          <textarea id="notes" rows="4" placeholder="Notes‚Ä¶"></textarea>
        </div>

        <div class="row gap end">
          <button id="saveDraft" class="pill">Save Draft</button>
          <button id="saveTask" class="pill strong">Save Task</button>
        </div>
      </div>
    </section>

    <!-- RECORDS -->
    <section id="records" class="screen">
      <div class="card p">
        <h2>Records</h2>
        <div class="filters">
          <div class="row gap wrap">
            <div class="field flex">
              <label>Search (road / weed / job / batch)</label>
              <input id="recSearch" placeholder="e.g. Wombat Road / Blackberry / B123"/>
            </div>
            <button id="recSearchBtn" class="pill">Search</button>
            <button id="recResetBtn" class="pill">Reset</button>
            <button id="recFilterToggle" class="pill">+ Filter</button>
          </div>
          <div id="recFilters" class="filter-box" style="display:none">
            <div class="row gap wrap">
              <div class="field">
                <label>From</label>
                <input id="recFrom" type="date"/>
              </div>
              <div class="field">
                <label>To</label>
                <input id="recTo" type="date"/>
              </div>
              <div class="field">
                <label>Types</label>
                <div class="row gap">
                  <label class="chip"><input id="fInspection" type="checkbox"> Inspection</label>
                  <label class="chip"><input id="fSpot" type="checkbox"> Spot</label>
                  <label class="chip"><input id="fRoad" type="checkbox"> Road</label>
                </div>
              </div>
              <div class="field">
                <label>Status</label>
                <div class="row gap">
                  <label class="chip"><input id="fComplete" type="checkbox"> Complete</label>
                  <label class="chip"><input id="fIncomplete" type="checkbox"> Incomplete</label>
                  <label class="chip"><input id="fDraft" type="checkbox"> Draft</label>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div id="recordsList" class="list"></div>
      </div>
    </section>

    <!-- INVENTORY -->
    <section id="inventory" class="screen">
      <div class="card p">
        <h2>Chemical Inventory</h2>
        <div class="row gap wrap">
          <button id="addChem" class="pill">Add Chemical</button>
          <div class="field flex">
            <label>Search (name / active)</label>
            <input id="chemSearch" placeholder="e.g. Crucial / Glyphosate"/>
          </div>
          <button id="chemSearchBtn" class="pill">Search</button>
          <button id="chemResetBtn" class="pill">Reset</button>
        </div>
        <div id="chemList" class="list"></div>

        <!-- Full-screen editor sheet -->
        <div id="chemEditSheet" class="sheet" style="display:none">
          <div class="card p">
            <h3>Edit Chemical</h3>
            <div class="row gap wrap">
              <div class="field">
                <label>Name</label><input id="ce_name"/>
              </div>
              <div class="field">
                <label>Active</label><input id="ce_active"/>
              </div>
              <div class="field mini">
                <label>Container Size</label><input id="ce_size" inputmode="decimal"/>
              </div>
              <div class="field mini">
                <label>Unit</label>
                <select id="ce_unit">
                  <option>L</option>
                  <option>mL</option>
                  <option>g</option>
                  <option>kg</option>
                </select>
              </div>
              <div class="field mini">
                <label>Containers</label><input id="ce_count" inputmode="decimal"/>
              </div>
              <div class="field mini">
                <label>Reorder Threshold (containers)</label><input id="ce_threshold" inputmode="decimal"/>
              </div>
            </div>
            <div class="row gap end">
              <button id="ce_cancel" class="pill">Close</button>
              <button id="ce_save" class="pill strong">Save</button>
            </div>
          </div>
        </div>

        <div class="card p">
          <h3>Procurement Alerts</h3>
          <ul id="procList" class="bullets"></ul>
        </div>
      </div>
    </section>

    <!-- BATCHES -->
    <section id="batches" class="screen">
      <div class="card p">
        <h2>Create Batch</h2>
        <div class="batch-form" id="batchForm">
          <div class="row gap wrap">
            <div class="field">
              <label>Auto-Name</label>
              <input id="bf_name" placeholder="e.g. BATCH221025-RS"/>
            </div>
            <div class="field">
              <label>Date</label>
              <input id="bf_date" type="date"/>
            </div>
            <div class="field">
              <label>Time</label>
              <input id="bf_time" type="time"/>
            </div>
          </div>

          <div class="field">
            <label>Total Mix (L)</label>
            <input id="bf_totalMix" inputmode="decimal" />
          </div>

          <div class="field">
            <label>Chemicals (add rows)</label>
            <div id="bf_rows" class="chem-rows"></div>
            <button id="bf_addRow" class="pill">+ Add Chemical</button>
          </div>

          <div class="card p soft">
            <div id="bf_summary">Totals: ‚Äì</div>
          </div>

          <div class="row gap end">
            <button id="bf_deleteDraft" class="pill warn">Delete (if draft)</button>
            <button id="bf_create" class="pill strong">Create Batch</button>
          </div>
        </div>
      </div>

      <div class="card p">
        <h2>All Batches</h2>
        <div class="row gap wrap">
          <div class="field">
            <label>From</label><input id="batFrom" type="date"/>
          </div>
          <div class="field">
            <label>To</label><input id="batTo" type="date"/>
          </div>
          <button id="batSearchBtn" class="pill">Search</button>
          <button id="batResetBtn" class="pill">Reset</button>
        </div>
        <div id="batchList" class="list"></div>
      </div>
    </section>

    <!-- PROCUREMENT placeholder screen (lists from inventory) -->
    <section id="procurement" class="screen">
      <div class="card p">
        <h2>Procurement List</h2>
        <ul id="procList2" class="bullets"></ul>
      </div>
    </section>

    <!-- MAPPING -->
    <section id="mapping" class="screen">
      <div class="card p">
        <h2>Mapping</h2>
        <div class="filters">
          <div class="row gap wrap">
            <div class="field flex">
              <label>Search (road / weed)</label>
              <input id="mapWeed" placeholder="e.g. Wombat Road / Blackberry"/>
            </div>
            <div class="field">
              <label>Type</label>
              <select id="mapType">
                <option>All</option>
                <option>Inspection</option>
                <option>Spot Spray</option>
                <option>Road Spray</option>
              </select>
            </div>
            <button id="mapSearchBtn" class="pill">Search</button>
            <button id="mapResetBtn" class="pill">Reset</button>
          </div>
        </div>
        <div id="map" style="height: 65vh; border-radius: 10px; overflow: hidden;"></div>
      </div>
    </section>

    <!-- SETTINGS -->
    <section id="settings" class="screen">
      <div class="card p">
        <h2>Settings</h2>
        <div class="field">
          <label>Account Email (for future sync)</label>
          <input id="accountEmail" type="email" placeholder="you@example.com"/>
        </div>
        <div class="row gap">
          <button id="saveAccount" class="pill">Save Account</button>
        </div>

        <div class="row gap" style="margin-top:1rem">
          <button id="exportBtn" class="pill">Export Data</button>
          <button id="restoreBtn" class="pill">Restore Latest Backup</button>
          <button id="clearBtn" class="pill warn">Clear All Local Data</button>
        </div>

        <div class="card p soft" style="margin-top:1rem">
          <b>SDS Portal:</b> <a href="https://www.pilot.net.au/sds" target="_blank" rel="noopener">Open Safety Data Sheets</a>
        </div>
      </div>
    </section>
  </main>

  <!-- Popup container -->
  <div id="popupHost"></div>

  <!-- Scripts (order matters) -->
  <script src="storage.js"></script>
  <script src="extras.js"></script>
  <script src="batches.js"></script>
  <script src="apps.js"></script>
</body>
</html>
