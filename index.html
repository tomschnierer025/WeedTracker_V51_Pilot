<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WeedTracker V60 Pilot</title>
  <link rel="stylesheet" href="styles.css" />

  <!-- Leaflet (mapping) -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" defer></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
  <!-- Splash -->
  <div id="splash">🌿 WeedTracker V60 Pilot</div>

  <!-- Spinner overlay -->
  <div id="spinnerOverlay">
    <div class="spinner"></div>
    <div class="spinner-msg" id="spinnerMsg">Working…</div>
  </div>

  <!-- HOME -->
  <section id="home" class="screen active">
    <h2>WeedTracker V60 Pilot</h2>
    <div class="home-grid">
      <button class="home-card btn-task" data-target="createTask"><span class="icon">🧾</span> Create Task</button>
      <button class="home-card btn-records" data-target="records"><span class="icon">📚</span> Records</button>
      <button class="home-card btn-batches" data-target="batches"><span class="icon">⚗️</span> Batches</button>
      <button class="home-card btn-chems" data-target="inventory"><span class="icon">🧪</span> Chemical Inventory</button>
      <button class="home-card btn-proc" data-target="procurement"><span class="icon">🛒</span> Procurement List</button>
      <button class="home-card btn-map" data-target="mapping"><span class="icon">🗺️</span> Mapping</button>
      <button class="home-card btn-settings" data-target="settings"><span class="icon">⚙️</span> Settings</button>
    </div>
  </section>

  <!-- CREATE TASK -->
  <section id="createTask" class="screen">
    <button class="home-fab" title="Home" data-target="home">🏠</button>
    <h2>Create Task</h2>

    <div class="card">
      <div class="grid">
        <div>
          <label class="lbl">1️⃣ Job Type</label>
          <select id="taskType" class="in">
            <option>Inspection</option>
            <option>Spot Spray</option>
            <option>Road Spray</option>
          </select>
        </div>

        <div>
          <label class="lbl">📅 Job Date</label>
          <input type="date" id="jobDate" class="in"/>
        </div>

        <div>
          <label class="lbl">📍 Get Location</label>
          <div class="row gap">
            <button id="locateBtn" class="pill">Locate Me</button>
            <div id="locRoad" class="muted" style="flex:1">Location not yet found</div>
          </div>
        </div>

        <div>
          <label class="lbl">🪪 Auto Job Name</label>
          <div class="row gap">
            <button id="autoNameBtn" class="pill">Auto Name</button>
            <input id="jobName" class="in" placeholder="Job Name"/>
          </div>
          <div class="tiny muted">Format: RoadNameDDMMYYYY_I / _SS / _RS</div>
        </div>

        <div class="grid two">
          <div>
            <label class="lbl">Council Number</label>
            <input id="councilNum" class="in" placeholder="Council #"/>
          </div>
          <div>
            <label class="lbl">Link Inspection ID / Name</label>
            <input id="linkInspectionId" class="in" placeholder="e.g. 1723456789 or InspName"/>
          </div>
        </div>

        <div class="grid two">
          <div>
            <label class="lbl">🌱 Weed</label>
            <select id="weedSelect" class="in"></select>
          </div>
          <div>
            <label class="lbl">🧪 Batch</label>
            <select id="batchSelect" class="in"></select>
          </div>
        </div>

        <div id="roadTrackBlock" class="form-section" style="display:none">
          <div class="form-title">🚚 Roadside Tracking</div>
          <div class="row gap">
            <button id="startTrack" class="pill">▶ Start</button>
            <button id="stopTrack" class="pill warn">⏹ Stop</button>
            <div id="trackStatus" class="muted">Idle</div>
          </div>
        </div>

        <div class="form-section">
          <div class="form-title">🌦️ Weather</div>
          <div class="row gap">
            <button id="autoWeatherBtn" class="pill">Auto Weather</button>
            <div id="wxUpdated" class="muted tiny"></div>
          </div>
          <div class="grid four">
            <div><label class="lbl">Temp (°C)</label><input id="temp" type="number" class="in"/></div>
            <div><label class="lbl">Wind (km/h)</label><input id="wind" type="number" class="in"/></div>
            <div><label class="lbl">Direction</label><input id="windDir" class="in"/></div>
            <div><label class="lbl">Humidity (%)</label><input id="humidity" type="number" class="in"/></div>
          </div>
        </div>

        <div class="grid two">
          <div><label class="lbl">Start Time</label><input id="startTime" type="time" class="in"/></div>
          <div><label class="lbl">End Time</label><input id="endTime" type="time" class="in"/></div>
        </div>

        <div class="grid two">
          <div>
            <label class="lbl">Attach Photo</label>
            <input type="file" id="photoInput" class="in" accept="image/*" />
            <img id="photoPreview" class="photo-preview" style="display:none" />
          </div>
          <div>
            <label class="lbl">Reminder (weeks)</label>
            <select id="reminderWeeks" class="in"></select>
          </div>
        </div>

        <div>
          <label class="lbl">Notes</label>
          <textarea id="notes" rows="3" class="in" placeholder="Notes / Observations"></textarea>
        </div>

        <div id="statusRadios" class="row gap">
          <!-- will be injected (Complete / Incomplete) if missing -->
        </div>

        <div class="row gap end">
          <button id="saveTask" class="pill emph">💾 Save</button>
          <button id="saveDraft" class="pill">🕓 Save Draft</button>
        </div>
      </div>
    </div>
  </section>

  <!-- RECORDS -->
  <section id="records" class="screen">
    <button class="home-fab" title="Home" data-target="home">🏠</button>
    <h2>Records</h2>
    <div class="card">
      <div class="search-block">
        <input id="recSearch" class="in" placeholder="Search by job / road / weed / council"/>
        <div class="grid two">
          <div><label class="lbl">Date From</label><input type="date" id="recFrom" class="in"/></div>
          <div><label class="lbl">Date To</label><input type="date" id="recTo" class="in"/></div>
        </div>
        <div class="row wrap gap">
          <label class="chip"><input type="checkbox" id="fInspection"/> Inspection</label>
          <label class="chip"><input type="checkbox" id="fSpot"/> Spot</label>
          <label class="chip"><input type="checkbox" id="fRoad"/> Road</label>
          <label class="chip"><input type="checkbox" id="fComplete"/> Complete</label>
          <label class="chip"><input type="checkbox" id="fIncomplete"/> Incomplete</label>
          <label class="chip"><input type="checkbox" id="fDraft"/> Draft</label>
        </div>
        <div class="row gap end">
          <button id="recSearchBtn" class="pill">Search</button>
          <button id="recResetBtn" class="pill">Reset</button>
        </div>
      </div>
      <div id="recordsList" class="list"></div>
    </div>
  </section>

  <!-- BATCHES -->
  <section id="batches" class="screen">
    <button class="home-fab" title="Home" data-target="home">🏠</button>
    <h2>Batches</h2>
    <div class="card">
      <div class="search-block">
        <div class="grid two">
          <div><label class="lbl">Date From</label><input type="date" id="batFrom" class="in"/></div>
          <div><label class="lbl">Date To</label><input type="date" id="batTo" class="in"/></div>
        </div>
        <div class="row gap end">
          <button id="batSearchBtn" class="pill">Search</button>
          <button id="batResetBtn" class="pill">Reset</button>
          <button id="newBatch" class="pill emph">➕ New Batch</button>
        </div>
      </div>
      <div id="batchList" class="list"></div>
    </div>
  </section>

  <!-- INVENTORY -->
  <section id="inventory" class="screen">
    <button class="home-fab" title="Home" data-target="home">🏠</button>
    <h2>Chemical Inventory</h2>
    <div class="card">
      <div class="row end">
        <button id="addChem" class="pill emph">➕ Add Chemical</button>
      </div>
      <div id="chemList" class="list"></div>
    </div>
  </section>

  <!-- PROCUREMENT -->
  <section id="procurement" class="screen">
    <button class="home-fab" title="Home" data-target="home">🏠</button>
    <h2>Procurement List</h2>
    <div class="card">
      <ul id="procList"></ul>
    </div>
  </section>

  <!-- MAPPING -->
  <section id="mapping" class="screen">
    <button class="home-fab" title="Home" data-target="home">🏠</button>
    <h2>Mapping</h2>
    <div class="card" id="mapWrap">
      <div class="search-block">
        <div class="grid two">
          <div><label class="lbl">Date From</label><input type="date" id="mapFrom" class="in"/></div>
          <div><label class="lbl">Date To</label><input type="date" id="mapTo" class="in"/></div>
        </div>
        <div class="grid two">
          <div><label class="lbl">Weed</label><input id="mapWeed" class="in" placeholder="Weed name"/></div>
          <div>
            <label class="lbl">Type</label>
            <select id="mapType" class="in">
              <option>All</option><option>Inspection</option><option>Spot Spray</option><option>Road Spray</option>
            </select>
          </div>
        </div>
        <div class="row gap end">
          <button id="mapSearchBtn" class="pill">Search</button>
          <button id="mapResetBtn" class="pill">Reset</button>
        </div>
      </div>

      <div id="map" class="map"></div>
    </div>
  </section>

  <!-- SETTINGS -->
  <section id="settings" class="screen">
    <button class="home-fab" title="Home" data-target="home">🏠</button>
    <h2>Settings / Data</h2>
    <div class="card">
      <div class="grid two">
        <div>
          <label class="lbl">Email (for backup)</label>
          <input id="accountEmail" class="in" placeholder="email@example.com"/>
        </div>
      </div>
      <div class="row gap end">
        <button id="saveAccount" class="pill">Save</button>
        <button id="exportBtn" class="pill">Export</button>
        <button id="restoreBtn" class="pill">Restore</button>
        <button id="clearBtn" class="pill warn">Clear</button>
      </div>
    </div>
  </section>

  <!-- Chem Edit Sheet -->
  <div id="chemEditSheet" class="modal" style="display:none">
    <div class="card p">
      <h3>Edit Chemical</h3>
      <label class="lbl">Name</label><input id="ce_name" class="in"/>
      <label class="lbl">Active Ingredient</label><input id="ce_active" class="in"/>
      <label class="lbl">Container Size</label><input id="ce_size" type="number" class="in"/>
      <label class="lbl">Unit (L, mL, g, kg)</label><input id="ce_unit" class="in"/>
      <label class="lbl">Containers</label><input id="ce_count" type="number" class="in"/>
      <label class="lbl">Threshold (containers)</label><input id="ce_threshold" type="number" class="in"/>
      <div class="row gap end">
        <button id="ce_save" class="pill">Save</button>
        <button id="ce_cancel" class="pill warn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- App scripts (order matters) -->
  <script src="storage.js"></script>
  <script src="extras.js"></script>
  <script src="batches.js"></script>
  <script src="settings.js"></script>
  <script src="apps.js"></script>
</body>
</html>
